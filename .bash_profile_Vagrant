#########################
# PATHs
#########################
export PATH="/usr/local/bin:/usr/local/sbin:/usr/local/share/npm/bin:/usr/local/bin/bin:$PATH"


#########################
# Git
#########################
# Show present working directory and Git branch at prompt
# source: http://www.developerzen.com/2011/01/10/show-the-current-git-branch-in-your-command-prompt/
function parse_git_branch () {
  git branch 2> /dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/ (\1)/'
}

# Git branch bash completion
if [ -f ~/.git-completion.bash ]; then
  . ~/.git-completion.bash

  # Add git completion to my aliases
  __git_complete ga _git_add
  __git_complete gb _git_branch
  __git_complete g __git_main
  __git_complete gc _git_commit
  __git_complete gco _git_checkout
  __git_complete gm _git_merge
  __git_complete gp _git_pull
fi

# aliases
alias g="git"
alias ga="git add"
alias gb="git branch"
alias gc="git commit"
alias gco="git checkout"
alias gcol="git checkout live"
alias gcom="git checkout master"
alias gcos="git checkout stable"
alias gd="git diff"
alias gl="git lg"
alias gm="git merge"
alias gp="git pull --ff"
alias gpol="git push origin live"
alias gpom="git push origin master"
alias gpos="git push origin stable"
alias gs="git status"

# ANSI colors: http://www.tldp.org/HOWTO/Bash-Prompt-HOWTO/x329.html
RED="\[\033[0;31m\]"
YELLOW="\[\033[0;33m\]"
GREEN="\[\033[0;32m\]"
PURPLE="\[\033[0;35m\]"
LIGHT_GREY="\[\033[0;37m\]"
DARK_GREY="\[\033[1;30m\]"
NO_COLOUR="\[\033[0m\]"

# Vagrant prompt config:
PS1="\[\033[0;31m\]THIS IS VAGRANT! $LIGHT_GREY\w$PURPLE\$(parse_git_branch)$NO_COLOUR\$ "


#########################
# Misc
#########################
alias cw="bundle exec compass watch" # this way you don't forget to use Bundler
alias ls="ls -la"
alias reload-bash-profile="source /home/vagrant/.bash_profile"


#########################
# CD BACKSLASH SHORTHAND
#########################
alias ..='cd ../'
alias ...='cd ../../'
alias ....='cd ../../../'
alias .....='cd ../../../../'


#########################
# Drush shortcuts & autocomplete (for Features and modules)
# Aliases for aliases!
#
# All commands & aliases: drushcommands.com
#########################
alias d="drush" # Save 4 keystrokes, yo!
alias dcca="drush cc all" # Clear all Drupal caches
alias den='drush pm-enable'
alias ddis='drush pm-disable'
alias df='drush features'
alias dfd='drush features-diff'
alias dfl="drush features-list" # List all the available features for your site
alias dfr='drush -y features-revert'
alias dfra='drush -y features-revert-all'
alias dfu='drush -y features-update'
alias dst="drush status" # Birds-eye view of current Drupal installation, if any 

alias create-admin-acct="drush user-create ldr --mail=ldavisrobeson@forumone.com && drush user-add-role administrator --name=ldr && drush user-add-role developer --name=ldr && drush uli --name=ldr" # Create admin acct (helpful after syncing with a db you don't have access to)

#########################
# The following is slightly modified from:
# Drush-Bash tricks 0.1 (http://nuvole.org/node/26)
# Copyright Nuvole 2010
# License: GPL 3, see http://www.gnu.org/licenses/gpl.html
#########################

_drupal_root() {
  # Go up until we find index.php
  current_dir=`pwd`;
  while [ ${current_dir} != "/" -a -d "${current_dir}" -a \
          ! -f "${current_dir}/index.php" ] ; 
  do
    current_dir=$(dirname "${current_dir}") ;
  done
  if [ "$current_dir" == "/" ] ; then
    exit 1 ;
  else
    echo "$current_dir" ;
  fi 
}

_drupal_modules_in_dir()
{
  COMPREPLY=( $( compgen -W '$( command find $1 -regex ".*\.module" -exec basename {} .module \; 2> /dev/null )' -- $cur  ) )
}

_drupal_modules()
{
  local cur
  COMPREPLY=()
  cur=${COMP_WORDS[COMP_CWORD]}
  local drupal_root=`_drupal_root` && \
  _drupal_modules_in_dir "$drupal_root/sites $drupal_root/profiles $drupal_root/modules"
}

_drupal_features_in_dir()
{
  COMPREPLY=( $( compgen -W '$( command find $1 -regex ".*\.features.inc" -exec basename {} .features.inc \; 2> /dev/null )' -- $cur  ) )
}

_drupal_features()
{
  local cur
  COMPREPLY=()
  cur=${COMP_WORDS[COMP_CWORD]}
  local drupal_root=`_drupal_root` && \
  _drupal_features_in_dir "$drupal_root/sites $drupal_root/profiles $drupal_root/modules"
}

# Example usage, revert a feature for project namespaced "foo":
# dfr foo_  # Then press TAB to trigger autocomplete (takes a second to load, be patient)
complete -F _drupal_modules den
complete -F _drupal_modules ddis
complete -F _drupal_features dfd
complete -F _drupal_features dfr
complete -F _drupal_features dfu
